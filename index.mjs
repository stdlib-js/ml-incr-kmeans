// Copyright (c) 2026 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.2.2-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-matrix-like@v0.2.2-esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@v0.2.2-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-minstd-shuffle@v0.2.1-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@v0.2.3-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ln@v0.2.4-esm/index.mjs";import d,{ndarray as m}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@v0.3.0-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@v0.2.2-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@v0.2.2-esm/index.mjs";import{ndarray as l}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@v0.2.1-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@v0.2.2-esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@esm/index.mjs";import{ndarray as v}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.2.2-esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@v0.2.2-esm/index.mjs";import{isPrimitive as b}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@esm/index.mjs";import{factory as x}from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-assert-contains@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@esm/index.mjs";import{factory as z}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-sample@esm/index.mjs";import{ndarray as k}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@esm/index.mjs";import{factory as A}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-discrete-uniform@esm/index.mjs";import{factory as q}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-mt19937@esm/index.mjs";import P from"https://cdn.jsdelivr.net/gh/stdlib-js/constants-float64-pinf@esm/index.mjs";import R from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-mean@esm/index.mjs";import S from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-meanstdev@esm/index.mjs";function _(r,t,e){return(e?h:p)("float64",new f(r*t),[r,t],[t,1],0,"row-major")}function B(r,t){var e,s,i,n,o,a,d,m,f,p,h;for(f=t.shape[0],p=t.shape[1],e=t.data,s=r.data,i=t.strides[0],n=t.strides[1],o=r.strides[0],a=r.strides[1],d=t.offset,m=r.offset,h=0;h<f;h++)l(p,e,n,d,s,a,m),d+=i,m+=o;return r}function D(r,t){return(t?u:j)("float64",new c(r),[r],[1],0,"row-major")}function L(r,t){return v(t.shape[0],t.data,t.strides[0],t.offset,r.data,r.strides[0],r.offset),r}var M=["euclidean","correlation","cosine"],N=["forgy","sample","kmeans++"],V=x(M),Y=x(N);var C={forgy:["forgy",1],sample:["sample",1],"kmeans++":["kmeans++",1,1]};function F(r,t,e,s){var i,n,o,a;for(n=0,i=s,a=0;a<r;a++)n+=(o=t[i])*o,i+=e;for(n=T(n),i=s,a=0;a<r;a++)t[i]/=n;return t}function G(r){var t,e,s,i,n,o,a;for(t=r.data,n=r.shape[0],o=r.shape[1],e=r.strides[0],s=r.strides[1],i=r.offset,a=0;a<n;a++)F(o,t,s,i),i+=e;return r}function H(r,t,e,s,i,n,o,a,d,m){var f,p,h,l;for(f=s,p=o,h=m,l=0;l<r;l++)t[f]=(t[f]-i[p])/a[h],f+=e,p+=n,h+=d;return t}function I(r,t){var e,s,i,n,o,a,d;for(e=r.data,o=r.shape[0],a=r.shape[1],s=r.strides[0],i=r.strides[1],n=r.offset,d=0;d<o;d++)H(a,e,i,n,t,2,0,t,2,1),n+=s;return r}function J(r,t,e,s,i,n,o){var a=function(r,t,e,s,i,n,o){var a,d,m,f,p;for(a=s,d=o,f=0,p=0;p<r;p++)f+=(m=t[a]-i[d])*m,a+=e,d+=n;return T(f)}(r,t,e,s,i,n,o);return a*a}function K(r,t,e,s,i,n,o){var a,d,m,f;for(a=s,d=o,m=0,f=0;f<r;f++)m+=t[a]*i[d],a+=e,d+=n;return m}function O(r,t,e,s,i,n,o){var a=1-K(r,t,e,s,i,n,o);return a*a}function Q(r,t,e,s,i,n,o){var a=1-K(r,t,e,s,i,n,o);return a*a}function U(r,t,e,s,i,n){var o,a,d,m,f;for(m=i.data,o=(d=i.strides[0])*n,a=0,f=0;f<e;f++)r[f]=t(s,m,1,a,m,1,o),a+=d;return r}function W(r,t,e,s,i,n,o,a,d){var m,f,p,h;for(m=P,h=0;h<t;h++)(p=r(e,s,1,n,o,a,d))<m&&(m=p,f=h),n+=i;return f}function X(r,t,e,s,i,n,o,a){var d,m;for(m=0;m<r;m++)d=e[i],d+=(n[a]-d)/t,e[i]=d,i+=s,a+=o;return e}function Z(r,t,e,s,i,n){var o,a;return a=r.shape[1],function(d){void 0===o&&((o=_(n.init[1],a,!0)).count=0);if(o.count<n.init[1]&&(v(a,d.data,d.strides[0],d.offset,o.data,o.strides[1],o.strides[0]*o.count),o.count+=1,o.count<n.init[1]))return!1;n.normalize&&("cosine"===n.metric?o=G(o):"correlation"===n.metric&&(o=I(o,s())));r="forgy"===n.init[0]?function(r,t,e){var s,i,n,o,a,d,m,f,p,h,l,c,j,u,v,g;for(j=r.shape[0],u=r.shape[1],i=r.data,m=r.strides[0],f=r.strides[1],h=r.offset,o=t.data,n=t.shape[0],a=t.strides[0],d=t.strides[1],c=t.offset,s=A(0,j-1,{seed:e}),p=[],v=0;v<j*u;v++)p.push(R());for(v=0;v<n;v++){for(l=u*s(),g=0;g<u;g++)p[l+g](o[c+d*g]);c+=a}for(l=0,v=0;v<j;v++){for(g=0;g<u;g++)i[h+f*g]=p[l](),l+=1;h+=m}return r}(r,o,n.seed):"sample"===n.init[0]?function(r,t,e){var s,i,n,o,a,d,m,f,p,h,l;for(p=r.shape[0],h=r.shape[1],i=r.data,d=r.strides[1],m=r.offset,n=t.data,o=t.strides[0],a=t.strides[1],s=[],l=0;l<t.shape[0];l++)s.push(l);for(f=p===s.length?s:z({seed:e,size:p,mutate:!1,replacement:!1})(s),l=0;l<p;l++)k(h,n,a,o*f[l],i,d,m);return r}(r,o,n.seed):function(r,t,e,s,i){var n,o,a,d,f,p,h,l,c,j,u,v,g,y,b,w,x,E,T,z,k,R,S,_,B,D,L,M;if(_=r.shape[0],d=r.shape[1],l=t.shape[0],v=r.data,x=r.strides[0],E=r.strides[1],T=r.offset,g=t.data,b=t.strides[0],w=t.strides[1],h=q({seed:i}),a=A({seed:h()}),h=h.normalized,u="cosine"===e?O:"correlation"===e?Q:J,S=a(0,l-1),1===_)return m(d,g,w,b*S,v,E,T);for(n=[S],z=new Array(d),f=new Array(2*l),y=0,D=0;D<l;D++)f[y]=P,f[y+1]=0,y+=2;for(p=new Array(l),L=1;L<_;L++){for(U(z,u,l,d,t,n[L-1]),c=0,y=0,D=0;D<l;D++)z[D]<f[y]?(f[y]=z[D],f[y+1]=L-1,c+=z[D]):c+=f[y],y+=2;for(p[0]=f[0]/c,y=2,D=1;D<l;D++)p[D]=p[D-1]+f[y]/c,y+=2;for(j=P,k=-1,M=0;M<s;M++){for(S=-1;-1===S;)for(B=h(),D=0;D<l;D++)if(B<p[D]){S=D;break}for(c=0,o=b*S,y=0,D=0;D<l;D++)(R=u(d,g,1,b*D,g,1,o))<f[y]?c+=R:c+=f[y],y+=2;c<j&&(j=c,k=S)}n.push(k)}for(D=0;D<_;D++)m(d,g,w,b*n[D],v,E,T),T+=x;return r}(r,o,n.metric,n.init[2],n.seed);return function(r,t,e,s,i){var n,o,a,d,m,f,p,h,l,c,j;for(l=t.shape[0],n=t.shape[1],d=r.shape[0],o=t.data,m=t.strides[0],a=r.data,f=r.strides[0],h=0,j=0;j<d;j++)p=m*(c=W(i,l,n,o,m,0,a,1,h)),X(n,e.get(c,0)+1,o,1,p,a,1,h),s(c,i(n,o,1,p,a,1,h)),h+=f}(o,r,t,e,i),!0}}var $=4;function rr(){var m,p,h,l,c,j,u,v,x,z,k,A,q,P;if(t(arguments[0]))P=arguments[0].shape[0],v=arguments[0].shape[1],p=B(p=_(P,v,!0),arguments[0]),arguments.length>1&&(l=arguments[1],q=!0);else{if(!r(arguments[0]))throw new TypeError(i("0h34q",arguments[0]));if(P=arguments[0],!r(v=arguments[1]))throw new TypeError(i("0h34p",v));arguments.length>2&&(l=arguments[2],q=!0)}if((z={metric:"euclidean",init:C["kmeans++"].slice(),seed:n(),normalize:!0,copy:!0}).init[1]=P,z.init[2]=2+o(a(P)),q&&(A=function(t,e){if(!g(e))return new TypeError(E("0h32V",e));if(y(e,"metric")&&(t.metric=e.metric,!V(t.metric)))return new TypeError(E("0h34S","metric",M.join('", "'),t.metric));if(y(e,"init")){if(!w(e.init))return new TypeError(E("0h34l","init",e.init));if(!Y(e.init[0]))return new TypeError(E("0h34y","init",N.join('", "'),e.init[0]));if(t.init[0]=e.init[0],e.init.length>1&&(t.init[1]=e.init[1],!r(t.init[1])))return new TypeError(E("0h34z","init",t.init[1]));if(e.init.length>2&&(t.init[2]=e.init[2],!r(t.init[2])))return new TypeError(E("0h350","init",t.init[2]))}return y(e,"normalize")&&(t.normalize=e.normalize,!b(t.normalize))?new TypeError(E("0h32o","normalize",t.normalize)):y(e,"copy")&&(t.copy=e.copy,!b(t.copy))?new TypeError(E("0h32o","copy",t.copy)):(y(e,"seed")&&(t.seed=e.seed),null)}(z,l),A))throw A;if(z.init[1]<P)throw new RangeError(i("0h34r","init",z.init[1]));return c=function(r,t){var e={};return e.centroids=_(r,t,!1),e.stats=_(r,$,!1),e}(P,v),u=_(P,$,!0),m=function(r,t){var e,s;for(e=[],s=0;s<t;s++)e.push(0);return function(t,s){var i,n,o;return o=r.get(t,0)+1,r.set(t,0,o),r.set(t,1,r.get(t,1)+s),n=r.get(t,2),n+=(i=s-n)/o,e[t]+=i*(s-n),r.set(t,2,n),r.set(t,3,T(e[t]/(o-1))),r}}(u,P),"cosine"===z.metric?(x=O,z.copy&&(j=D(v,!0))):"correlation"===z.metric?(x=Q,z.normalize&&(h=function(r){var t,e,s,i,n;for(t=2*(s=new f(2*r)).BYTES_PER_ELEMENT,e=[],i=0,n=0;n<r;n++)e.push(S(new f(s.buffer,i,2))),i+=t;return function(t){var i;if(0===arguments.length)return s;for(i=0;i<r;i++)e[i](t.get(i));return s}}(v)),z.copy&&(j=D(v,!0))):x=J,void 0===p?(p=_(P,v,!0),k=Z(p,u,m,h,x,z)):B(c.centroids,p),s(R,"seed",z.seed),s(R,"predict",(function(r,s){var n,o,a,d,m,f,l,c,j,u,g;if(arguments.length>1){if(!e(r))throw new TypeError(i("0h3Ec",r));j=r,c=s}else c=r;if(!t(c))throw new TypeError(i("0h3Ed",c));if(c.shape[1]!==v)throw new Error(i("0h3Ee",v,c.shape[1]));if(void 0===j)j=D(c.shape[0],!1);else if(j.length!==c.shape[0])throw new Error(i("0h34x",c.shape[0],j.length));if(k)return null;a=c.shape[0],z.normalize&&("cosine"===z.metric?(z.copy&&(c=B(_(a,v,!0),c)),c=G(c)):"correlation"===z.metric&&(z.copy&&(c=B(_(a,v,!0),c)),c=I(c,h())));for(o=p.data,f=p.strides[0],n=c.data,d=c.strides[0],m=c.strides[1],l=c.offset,g=0;g<a;g++)u=W(x,P,v,o,f,0,n,m,l),j.set(g,u),l+=d;return j})),R;function R(r){var t,s,n,o,a,f,l,g,y,b,w;if(0===arguments.length)return k?null:c;if(!e(g=r))throw new TypeError(i("0h3Dd",g));if(g.shape[0]!==v)throw new Error(i("0h34t",v,g.shape[0]));if(h&&h(g),k){if(!1===k(g))return null;k=void 0}else z.normalize&&("cosine"===z.metric?(z.copy&&(g=L(j,g)),F(v,g.data,g.strides[0],g.offset)):"correlation"===z.metric&&(z.copy&&(g=L(j,g)),n=h(),H(v,g.data,g.strides[0],g.offset,n,2,0,n,2,1))),t=p.data,a=p.strides[0],s=g.data,o=g.strides[0],f=g.offset,l=a*(w=W(x,P,v,t,a,0,s,o,f)),y=u.get(w,0)+1,X(v,y,t,1,l,s,o,f),b=x(v,t,1,l,s,o,f),m(w,b);return d(p.length,p.data,1,c.centroids.data,1),d(u.length,u.data,1,c.stats.data,1),c}}export{rr as default};
//# sourceMappingURL=index.mjs.map
