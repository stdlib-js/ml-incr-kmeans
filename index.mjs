// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.1.0-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-matrix-like@v0.1.0-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@v0.1.0-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.1.0-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-minstd-shuffle@v0.1.0-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@v0.1.0-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ln@esm/index.mjs";import d,{ndarray as f}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@v0.1.0-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@v0.1.0-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@v0.1.0-esm/index.mjs";import{ndarray as c}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@v0.1.0-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.1.0-esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@v0.1.0-esm/index.mjs";import{isPrimitive as v}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@v0.1.0-esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@v0.1.0-esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@v0.1.0-esm/index.mjs";import{factory as b}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-sample@v0.1.0-esm/index.mjs";import{factory as w}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-discrete-uniform@v0.1.0-esm/index.mjs";import{factory as x}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-mt19937@v0.1.0-esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/constants-float64-pinf@v0.1.0-esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-mean@v0.1.0-esm/index.mjs";import z from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-meanstdev@v0.1.0-esm/index.mjs";function P(e,t,r){return(r?h:p)("float64",new m(e*t),[e,t],[t,1],0,"row-major")}function k(e,t){var r,s,i,n,o,a,d,f,m,p,h;for(m=t.shape[0],p=t.shape[1],r=t.data,s=e.data,i=t.strides[0],n=t.strides[1],o=e.strides[0],a=e.strides[1],d=t.offset,f=e.offset,h=0;h<m;h++)c(p,r,n,d,s,a,f),d+=i,f+=o;return e}function G(e,t){return(t?h:p)("float64",new m(e),[e],[1],0,"row-major")}function q(e,t){return c(t.shape[0],t.data,t.strides[0],t.offset,e.data,e.strides[0],e.offset),e}var A=["euclidean","correlation","cosine"],D=["forgy","sample","kmeans++"];function I(t,r){if(!l(r))return new TypeError(i("0h32V,FD",r));if(u(r,"metric")&&(t.metric=r.metric,!g(A,t.metric)))return new TypeError(i("0h32X,3g,4S,GD,Gg,Jm","metric",A.join('", "'),t.metric));if(u(r,"init")){if(!j(r.init))return new TypeError(i("0h34l,Ig","init",r.init));if(!g(D,r.init[0]))return new TypeError(i("0h34y,Ps","init",D.join('", "'),r.init[0]));if(t.init[0]=r.init[0],r.init.length>1&&(t.init[1]=r.init[1],!e(t.init[1])))return new TypeError(i("0h34z,Pt","init",t.init[1]));if(r.init.length>2&&(t.init[2]=r.init[2],!e(t.init[2])))return new TypeError(i("0h350,Pu","init",t.init[2]))}return u(r,"normalize")&&(t.normalize=r.normalize,!v(t.normalize))?new TypeError(i("0h32o,GE","normalize",t.normalize)):u(r,"copy")&&(t.copy=r.copy,!v(t.copy))?new TypeError(i("0h32o,GE","copy",t.copy)):(u(r,"seed")&&(t.seed=r.seed),null)}var R={forgy:["forgy",1],sample:["sample",1],"kmeans++":["kmeans++",1,1]};function S(e,t,r,s){var i,n,o,a;for(n=0,i=s,a=0;a<e;a++)n+=(o=t[i])*o,i+=r;for(n=y(n),i=s,a=0;a<e;a++)t[i]/=n;return t}function _(e){var t,r,s,i,n,o,a;for(t=e.data,n=e.shape[0],o=e.shape[1],r=e.strides[0],s=e.strides[1],i=e.offset,a=0;a<n;a++)S(o,t,s,i),i+=r;return e}function B(e,t,r,s,i,n,o,a,d,f){var m,p,h,c;for(m=s,p=o,h=f,c=0;c<e;c++)t[m]=(t[m]-i[p])/a[h],m+=r,p+=n,h+=d;return t}function F(e,t){var r,s,i,n,o,a,d;for(r=e.data,o=e.shape[0],a=e.shape[1],s=e.strides[0],i=e.strides[1],n=e.offset,d=0;d<o;d++)B(a,r,i,n,t,2,0,t,2,1),n+=s;return e}function J(e,t,r,s,i,n,o){var a=function(e,t,r,s,i,n,o){var a,d,f,m,p;for(a=s,d=o,m=0,p=0;p<e;p++)m+=(f=t[a]-i[d])*f,a+=r,d+=n;return y(m)}(e,t,r,s,i,n,o);return a*a}function L(e,t,r,s,i,n,o){var a,d,f,m;for(a=s,d=o,f=0,m=0;m<e;m++)f+=t[a]*i[d],a+=r,d+=n;return f}function M(e,t,r,s,i,n,o){var a=1-L(e,t,r,s,i,n,o);return a*a}function N(e,t,r,s,i,n,o){var a=1-L(e,t,r,s,i,n,o);return a*a}function V(e,t,r,s,i,n){var o,a,d,f,m;for(f=i.data,o=(d=i.strides[0])*n,a=0,m=0;m<r;m++)e[m]=t(s,f,1,a,f,1,o),a+=d;return e}function X(e,t,r,s,i,n,o,a,d){var f,m,p,h;for(f=E,h=0;h<t;h++)(p=e(r,s,1,n,o,a,d))<f&&(f=p,m=h),n+=i;return m}function Y(e,t,r,s,i,n,o,a){var d,f;for(f=0;f<e;f++)d=r[i],d+=(n[a]-d)/t,r[i]=d,i+=s,a+=o;return r}function C(e,t,r,s,i,n){var o,a;return a=e.shape[1],function(d){void 0===o&&((o=P(n.init[1],a,!0)).count=0);if(o.count<n.init[1]&&(c(a,d.data,d.strides[0],d.offset,o.data,o.strides[1],o.strides[0]*o.count),o.count+=1,o.count<n.init[1]))return!1;n.normalize&&("cosine"===n.metric?o=_(o):"correlation"===n.metric&&(o=F(o,s())));e="forgy"===n.init[0]?function(e,t,r){var s,i,n,o,a,d,f,m,p,h,c,l,u,v,j,g;for(u=e.shape[0],v=e.shape[1],i=e.data,f=e.strides[0],m=e.strides[1],h=e.offset,o=t.data,n=t.shape[0],a=t.strides[0],d=t.strides[1],l=t.offset,s=w(0,u-1,{seed:r}),p=[],j=0;j<u*v;j++)p.push(T());for(j=0;j<n;j++){for(c=v*s(),g=0;g<v;g++)p[c+g](o[l+d*g]);l+=a}for(c=0,j=0;j<u;j++){for(g=0;g<v;g++)i[h+m*g]=p[c](),c+=1;h+=f}return e}(e,o,n.seed):"sample"===n.init[0]?function(e,t,r){var s,i,n,o,a,d,m,p,h,c,l;for(h=e.shape[0],c=e.shape[1],i=e.data,d=e.strides[1],m=e.offset,n=t.data,o=t.strides[0],a=t.strides[1],s=[],l=0;l<t.shape[0];l++)s.push(l);for(p=h===s.length?s:b({seed:r,size:h,mutate:!1,replacement:!1})(s),l=0;l<h;l++)f(c,n,a,o*p[l],i,d,m);return e}(e,o,n.seed):function(e,t,r,s,i){var n,o,a,d,m,p,h,c,l,u,v,j,g,y,b,T,z,P,k,G,q,A,D,I,R,S,_,B;if(I=e.shape[0],d=e.shape[1],c=t.shape[0],j=e.data,z=e.strides[0],P=e.strides[1],k=e.offset,g=t.data,b=t.strides[0],T=t.strides[1],h=x({seed:i}),a=w({seed:h()}),h=h.normalized,v="cosine"===r?M:"correlation"===r?N:J,D=a(0,c-1),1===I)return f(d,g,T,b*D,j,P,k);for(n=[D],G=new Array(d),m=new Array(2*c),y=0,S=0;S<c;S++)m[y]=E,m[y+1]=0,y+=2;for(p=new Array(c),_=1;_<I;_++){for(V(G,v,c,d,t,n[_-1]),l=0,y=0,S=0;S<c;S++)G[S]<m[y]?(m[y]=G[S],m[y+1]=_-1,l+=G[S]):l+=m[y],y+=2;for(p[0]=m[0]/l,y=2,S=1;S<c;S++)p[S]=p[S-1]+m[y]/l,y+=2;for(u=E,q=-1,B=0;B<s;B++){for(D=-1;-1===D;)for(R=h(),S=0;S<c;S++)if(R<p[S]){D=S;break}for(l=0,o=b*D,y=0,S=0;S<c;S++)(A=v(d,g,1,b*S,g,1,o))<m[y]?l+=A:l+=m[y],y+=2;l<u&&(u=l,q=D)}n.push(q)}for(S=0;S<I;S++)f(d,g,T,b*n[S],j,P,k),k+=z;return e}(e,o,n.metric,n.init[2],n.seed);return function(e,t,r,s,i){var n,o,a,d,f,m,p,h,c,l,u;for(c=t.shape[0],n=t.shape[1],d=e.shape[0],o=t.data,f=t.strides[0],a=e.data,m=e.strides[0],h=0,u=0;u<d;u++)p=f*(l=X(i,c,n,o,f,0,a,1,h)),Y(n,r.get(l,0)+1,o,1,p,a,1,h),s(l,i(n,o,1,p,a,1,h)),h+=m}(o,e,t,r,i),!0}}function H(e,t){var r,s;for(r=[],s=0;s<t;s++)r.push(0);return function(t,s){var i,n,o;return o=e.get(t,0)+1,e.set(t,0,o),e.set(t,1,e.get(t,1)+s),n=e.get(t,2),n+=(i=s-n)/o,r[t]+=i*(s-n),e.set(t,2,n),e.set(t,3,y(r[t]/(o-1))),e}}function K(e){var t,r,s,i,n;for(2,t=2*(s=new m(2*e)).BYTES_PER_ELEMENT,r=[],i=0,n=0;n<e;n++)r.push(z(new m(s.buffer,i,2))),i+=t;return function(t){var i;if(0===arguments.length)return s;for(i=0;i<e;i++)r[i](t.get(i));return s}}function O(e,t){var r={};return r.centroids=P(e,t,!1),r.stats=P(e,4,!1),r}function Q(){var f,m,p,h,c,l,u,v,j,g,y,b,w,x;if(t(arguments[0]))x=arguments[0].shape[0],v=arguments[0].shape[1],m=k(m=P(x,v,!0),arguments[0]),arguments.length>1&&(h=arguments[1],w=!0);else{if(!e(arguments[0]))throw new TypeError(i("0h34q,Pl",arguments[0]));if(x=arguments[0],!e(v=arguments[1]))throw new TypeError(i("0h34p,Pk",v));arguments.length>2&&(h=arguments[2],w=!0)}if((g={metric:"euclidean",init:R["kmeans++"].slice(),seed:n(),normalize:!0,copy:!0}).init[1]=x,g.init[2]=2+o(a(x)),w&&(b=I(g,h)))throw b;if(g.init[1]<x)throw new RangeError(i("0h34r,Pm","init",g.init[1]));return c=O(x,v),u=P(x,4,!0),f=H(u,x),"cosine"===g.metric?(j=M,g.copy&&(l=G(v,!0))):"correlation"===g.metric?(j=N,g.normalize&&(p=K(v)),g.copy&&(l=G(v,!0))):j=J,void 0===m?(m=P(x,v,!0),y=C(m,u,f,p,j,g)):k(c.centroids,m),s(E,"seed",g.seed),s(E,"predict",T),E;function E(e){var t,s,n,o,a,h,b,w,E,T,z;if(0===arguments.length)return y?null:c;if(!r(w=e))throw new TypeError(i("0h3I2",w));if(w.shape[0]!==v)throw new Error(i("0h34t,Pn",v,w.shape[0]));if(p&&p(w),y){if(!1===y(w))return null;y=void 0}else g.normalize&&("cosine"===g.metric?(g.copy&&(w=q(l,w)),S(v,w.data,w.strides[0],w.offset)):"correlation"===g.metric&&(g.copy&&(w=q(l,w)),n=p(),B(v,w.data,w.strides[0],w.offset,n,2,0,n,2,1))),t=m.data,a=m.strides[0],s=w.data,o=w.strides[0],h=w.offset,b=a*(z=X(j,x,v,t,a,0,s,o,h)),E=u.get(z,0)+1,Y(v,E,t,1,b,s,o,h),T=j(v,t,1,b,s,o,h),f(z,T);return d(m.length,m.data,1,c.centroids.data,1),d(u.length,u.data,1,c.stats.data,1),c}function T(e,s){var n,o,a,d,f,h,c,l,u,b,w;if(arguments.length>1){if(!r(e))throw new TypeError(i("0h3Po",e));u=e,l=s}else l=e;if(!t(l))throw new TypeError(i("0h3Pp",l));if(l.shape[1]!==v)throw new Error(i("0h3Pq",v,l.shape[1]));if(void 0===u)u=G(l.shape[0],!1);else if(u.length!==l.shape[0])throw new Error(i("0h34x,Pr",l.shape[0],u.length));if(y)return null;for(a=l.shape[0],g.normalize&&("cosine"===g.metric?(g.copy&&(l=k(P(a,v,!0),l)),l=_(l)):"correlation"===g.metric&&(g.copy&&(l=k(P(a,v,!0),l)),l=F(l,p()))),o=m.data,h=m.strides[0],n=l.data,d=l.strides[0],f=l.strides[1],c=l.offset,w=0;w<a;w++)b=X(j,x,v,o,h,0,n,f,c),u.set(w,b),c+=d;return u}}export{Q as default};
//# sourceMappingURL=index.mjs.map
