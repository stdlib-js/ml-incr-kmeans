// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-matrix-like@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-minstd-shuffle@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ln@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/random-sample@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-discrete-uniform@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-mt19937@esm/index.mjs";import x from"https://cdn.jsdelivr.net/gh/stdlib-js/constants-float64-pinf@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-mean@esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-meanstdev@esm/index.mjs";var z=m,R=f,L=p;var k=function(r,e,t){return(t?L:R)("float64",new z(r*e),[r,e],[e,1],0,"row-major")},A=l.ndarray;var O=function(r,e){var t,s,i,n,o,a,d,m,f,p,l;for(f=e.shape[0],p=e.shape[1],t=e.data,s=r.data,i=e.strides[0],n=e.strides[1],o=r.strides[0],a=r.strides[1],d=e.offset,m=r.offset,l=0;l<f;l++)A(p,t,n,d,s,a,m),d+=i,m+=o;return r},P=m,M=f,V=p;var q=function(r,e){return(e?V:M)("float64",new P(r),[r],[1],0,"row-major")},B=l.ndarray;var F=function(r,e){return B(e.shape[0],e.data,e.strides[0],e.offset,r.data,r.strides[0],r.offset),r},N=c,S=u,_=h.isPrimitive,Y=v,C=r.isPrimitive,D=j,G=i,H=["euclidean","correlation","cosine"],I=["forgy","sample","kmeans++"];var J=function(r,e){if(!N(e))return new TypeError(G("0LR2h",e));if(S(e,"metric")&&(r.metric=e.metric,!D(H,r.metric)))return new TypeError(G("0LR3t","metric",H.join('", "'),r.metric));if(S(e,"init")){if(!Y(e.init))return new TypeError(G("0LR4y","init",e.init));if(!D(I,e.init[0]))return new TypeError(G("0LR5B","init",I.join('", "'),e.init[0]));if(r.init[0]=e.init[0],e.init.length>1&&(r.init[1]=e.init[1],!C(r.init[1])))return new TypeError(G("invalid option. First `%s` parameter option must be a positive integer. Option: `%s`.","init",r.init[1]));if(e.init.length>2&&(r.init[2]=e.init[2],!C(r.init[2])))return new TypeError(G("invalid option. Second `%s` parameter option must be a positive integer. Option: `%s`.","init",r.init[2]))}return S(e,"normalize")&&(r.normalize=e.normalize,!_(r.normalize))?new TypeError(G("0LR30","normalize",r.normalize)):S(e,"copy")&&(r.copy=e.copy,!_(r.copy))?new TypeError(G("0LR30","copy",r.copy)):(S(e,"seed")&&(r.seed=e.seed),null)},K={forgy:["forgy",1],sample:["sample",1],"kmeans++":["kmeans++",1,1]},Q=g;var U=function(r,e,t,s){var i,n,o,a;for(n=0,i=s,a=0;a<r;a++)n+=(o=e[i])*o,i+=t;for(n=Q(n),i=s,a=0;a<r;a++)e[i]/=n;return e},W=U;var X=function(r){var e,t,s,i,n,o,a;for(e=r.data,n=r.shape[0],o=r.shape[1],t=r.strides[0],s=r.strides[1],i=r.offset,a=0;a<n;a++)W(o,e,s,i),i+=t;return r};var Z=function(r,e,t,s,i,n,o,a,d,m){var f,p,l,c;for(f=s,p=o,l=m,c=0;c<r;c++)e[f]=(e[f]-i[p])/a[l],f+=t,p+=n,l+=d;return e},$=Z;var rr=function(r,e){var t,s,i,n,o,a,d;for(t=r.data,o=r.shape[0],a=r.shape[1],s=r.strides[0],i=r.strides[1],n=r.offset,d=0;d<o;d++)$(a,t,i,n,e,2,0,e,2,1),n+=s;return r},er=y.factory,tr=d.ndarray;var sr=function(r,e,t){var s,i,n,o,a,d,m,f,p,l,c;for(p=r.shape[0],l=r.shape[1],i=r.data,d=r.strides[1],m=r.offset,n=e.data,o=e.strides[0],a=e.strides[1],s=[],c=0;c<e.shape[0];c++)s.push(c);for(f=p===s.length?s:er({seed:t,size:p,mutate:!1,replacement:!1})(s),c=0;c<p;c++)tr(l,n,a,o*f[c],i,d,m);return r},ir=g;var nr=function(r,e,t,s,i,n,o){var a,d,m,f,p;for(a=s,d=o,f=0,p=0;p<r;p++)f+=(m=e[a]-i[d])*m,a+=t,d+=n;return ir(f)};var or=function(r,e,t,s,i,n,o){var a=nr(r,e,t,s,i,n,o);return a*a};var ar=function(r,e,t,s,i,n,o){var a,d,m,f;for(a=s,d=o,m=0,f=0;f<r;f++)m+=e[a]*i[d],a+=t,d+=n;return m},dr=ar;var mr=function(r,e,t,s,i,n,o){var a=1-dr(r,e,t,s,i,n,o);return a*a},fr=ar;var pr=function(r,e,t,s,i,n,o){var a=1-fr(r,e,t,s,i,n,o);return a*a},lr=b.factory,cr=w.factory,ur=x,hr=d.ndarray,vr=or,jr=mr,gr=pr;function yr(r,e,t,s,i,n){var o,a,d,m,f;for(m=i.data,o=(d=i.strides[0])*n,a=0,f=0;f<t;f++)r[f]=e(s,m,1,a,m,1,o),a+=d;return r}var br=function(r,e,t,s,i){var n,o,a,d,m,f,p,l,c,u,h,v,j,g,y,b,w,x,E,T,z,R,L,k,A,O,P,M;if(k=r.shape[0],d=r.shape[1],l=e.shape[0],v=r.data,w=r.strides[0],x=r.strides[1],E=r.offset,j=e.data,y=e.strides[0],b=e.strides[1],p=cr({seed:i}),a=lr({seed:p()}),p=p.normalized,h="cosine"===t?jr:"correlation"===t?gr:vr,L=a(0,l-1),1===k)return hr(d,j,b,y*L,v,x,E);for(n=[L],T=new Array(d),m=new Array(2*l),g=0,O=0;O<l;O++)m[g]=ur,m[g+1]=0,g+=2;for(f=new Array(l),P=1;P<k;P++){for(yr(T,h,l,d,e,n[P-1]),c=0,g=0,O=0;O<l;O++)T[O]<m[g]?(m[g]=T[O],m[g+1]=P-1,c+=T[O]):c+=m[g],g+=2;for(f[0]=m[0]/c,g=2,O=1;O<l;O++)f[O]=f[O-1]+m[g]/c,g+=2;for(u=ur,z=-1,M=0;M<s;M++){for(L=-1;-1===L;)for(A=p(),O=0;O<l;O++)if(A<f[O]){L=O;break}for(c=0,o=y*L,g=0,O=0;O<l;O++)(R=h(d,j,1,y*O,j,1,o))<m[g]?c+=R:c+=m[g],g+=2;c<u&&(u=c,z=L)}n.push(z)}for(O=0;O<k;O++)hr(d,j,b,y*n[O],v,x,E),E+=w;return r},wr=b.factory,xr=E;var Er=function(r,e,t){var s,i,n,o,a,d,m,f,p,l,c,u,h,v,j,g;for(h=r.shape[0],v=r.shape[1],i=r.data,m=r.strides[0],f=r.strides[1],l=r.offset,o=e.data,n=e.shape[0],a=e.strides[0],d=e.strides[1],u=e.offset,s=wr(0,h-1,{seed:t}),p=[],j=0;j<h*v;j++)p.push(xr());for(j=0;j<n;j++){for(c=v*s(),g=0;g<v;g++)p[c+g](o[u+d*g]);u+=a}for(c=0,j=0;j<h;j++){for(g=0;g<v;g++)i[l+f*g]=p[c](),c+=1;l+=m}return r},Tr=x;var zr=function(r,e,t,s,i,n,o,a,d){var m,f,p,l;for(m=Tr,l=0;l<e;l++)(p=r(t,s,1,n,o,a,d))<m&&(m=p,f=l),n+=i;return f};var Rr=function(r,e,t,s,i,n,o,a){var d,m;for(m=0;m<r;m++)d=t[i],d+=(n[a]-d)/e,t[i]=d,i+=s,a+=o;return t},Lr=zr,kr=Rr;var Ar=function(r,e,t,s,i){var n,o,a,d,m,f,p,l,c,u,h,v;for(u=e.shape[0],n=e.shape[1],d=r.shape[0],o=e.data,m=e.strides[0],a=r.data,f=r.strides[0],l=0,v=0;v<d;v++)p=m*(h=Lr(i,u,n,o,m,0,a,1,l)),c=t.get(h,0)+1,kr(n,c,o,1,p,a,1,l),s(h,i(n,o,1,p,a,1,l)),l+=f},Or=l.ndarray,Pr=k,Mr=X,Vr=rr,qr=sr,Br=br,Fr=Er,Nr=Ar;var Sr=function(r,e,t,s,i,n){var o,a;return a=r.shape[1],function(d){void 0===o&&((o=Pr(n.init[1],a,!0)).count=0);if(o.count<n.init[1]&&(Or(a,d.data,d.strides[0],d.offset,o.data,o.strides[1],o.strides[0]*o.count),o.count+=1,o.count<n.init[1]))return!1;n.normalize&&("cosine"===n.metric?o=Mr(o):"correlation"===n.metric&&(o=Vr(o,s())));r="forgy"===n.init[0]?Fr(r,o,n.seed):"sample"===n.init[0]?qr(r,o,n.seed):Br(r,o,n.metric,n.init[2],n.seed);return Nr(o,r,e,t,i),!0}},_r=g;var Yr=function(r,e){var t,s;for(t=[],s=0;s<e;s++)t.push(0);return function(e,s){var i,n,o;return o=r.get(e,0)+1,r.set(e,0,o),r.set(e,1,r.get(e,1)+s),n=r.get(e,2),n+=(i=s-n)/o,t[e]+=i*(s-n),r.set(e,2,n),r.set(e,3,_r(t[e]/(o-1))),r}},Cr=T,Dr=m;var Gr=function(r){var e,t,s,i,n;for(2,e=2*(s=new Dr(2*r)).BYTES_PER_ELEMENT,t=[],i=0,n=0;n<r;n++)t.push(Cr(new Dr(s.buffer,i,2))),i+=e;return function(e){var i;if(0===arguments.length)return s;for(i=0;i<r;i++)t[i](e.get(i));return s}},Hr=r.isPrimitive,Ir=e,Jr=t,Kr=s,Qr=i,Ur=n,Wr=o,Xr=a,Zr=d,$r=k,re=O,ee=q,te=F,se=J,ie=K,ne=Sr,oe=Yr,ae=Gr,de=or,me=mr,fe=pr,pe=zr,le=Rr,ce=U,ue=X,he=Z,ve=rr;function je(r,e){var t={};return t.centroids=$r(r,e,!1),t.stats=$r(r,4,!1),t}var ge=function(){var r,e,t,s,i,n,o,a,d,m,f,p,l,c;if(Ir(arguments[0]))c=arguments[0].shape[0],a=arguments[0].shape[1],e=$r(c,a,!0),e=re(e,arguments[0]),arguments.length>1&&(s=arguments[1],l=!0);else{if(!Hr(arguments[0]))throw new TypeError(Qr("0LR53",arguments[0]));if(c=arguments[0],!Hr(a=arguments[1]))throw new TypeError(Qr("0LR52",a));arguments.length>2&&(s=arguments[2],l=!0)}if((m={metric:"euclidean",init:ie["kmeans++"].slice(),seed:Ur(),normalize:!0,copy:!0}).init[1]=c,m.init[2]=2+Wr(Xr(c)),l&&(p=se(m,s)))throw p;if(m.init[1]<c)throw new RangeError(Qr("invalid option. First `%s` parameter option must be greater than or equal to the number of clusters. Options: `%f`.","init",m.init[1]));return i=je(c,a),o=$r(c,4,!0),r=oe(o,c),"cosine"===m.metric?(d=me,m.copy&&(n=ee(a,!0))):"correlation"===m.metric?(d=fe,m.normalize&&(t=ae(a)),m.copy&&(n=ee(a,!0))):d=de,void 0===e?(e=$r(c,a,!0),f=ne(e,o,r,t,d,m)):re(i.centroids,e),Kr(u,"seed",m.seed),Kr(u,"predict",h),u;function u(s){var p,l,u,h,v,j,g,y,b,w,x;if(0===arguments.length)return f?null:i;if(!Jr(y=s))throw new TypeError(Qr("invalid argument. Must provide a one-dimensional ndarray. Value: `%s`.",y));if(y.shape[0]!==a)throw new Error(Qr("0LR56",a,y.shape[0]));if(t&&t(y),f){if(!1===f(y))return null;f=void 0}else m.normalize&&("cosine"===m.metric?(m.copy&&(y=te(n,y)),ce(a,y.data,y.strides[0],y.offset)):"correlation"===m.metric&&(m.copy&&(y=te(n,y)),u=t(),he(a,y.data,y.strides[0],y.offset,u,2,0,u,2,1))),p=e.data,v=e.strides[0],l=y.data,h=y.strides[0],j=y.offset,g=v*(x=pe(d,c,a,p,v,0,l,h,j)),b=o.get(x,0)+1,le(a,b,p,1,g,l,h,j),w=d(a,p,1,g,l,h,j),r(x,w);return Zr(e.length,e.data,1,i.centroids.data,1),Zr(o.length,o.data,1,i.stats.data,1),i}function h(r,s){var i,n,o,p,l,u,h,v,j,g,y;if(arguments.length>1){if(!Jr(r))throw new TypeError(Qr("invalid argument. Output argument must be a one-dimensional ndarray. Value: `%s`.",r));j=r,v=s}else v=r;if(!Ir(v))throw new TypeError(Qr("invalid argument. Must provide a two-dimensional ndarray. Value: `%s`.",v));if(v.shape[1]!==a)throw new Error(Qr("invalid argument. Number of matrix columns must match centroid dimensions. Expected: `%u`. Actual: `%u`.",a,v.shape[1]));if(void 0===j)j=ee(v.shape[0],!1);else if(j.length!==v.shape[0])throw new Error(Qr("0LR5A",v.shape[0],j.length));if(f)return null;for(o=v.shape[0],m.normalize&&("cosine"===m.metric?(m.copy&&(v=re($r(o,a,!0),v)),v=ue(v)):"correlation"===m.metric&&(m.copy&&(v=re($r(o,a,!0),v)),v=ve(v,t()))),n=e.data,u=e.strides[0],i=v.data,p=v.strides[0],l=v.strides[1],h=v.offset,y=0;y<o;y++)g=pe(d,c,a,n,u,0,i,l,h),j.set(y,g),h+=p;return j}},ye=ge;export{ye as default};
//# sourceMappingURL=index.mjs.map
